
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/renderer/webgl/assemblers/sprite/2d/tiled.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _assembler2d = _interopRequireDefault(require("../../../../assembler-2d"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }

var TiledAssembler =
/*#__PURE__*/
function (_Assembler2D) {
  _inheritsLoose(TiledAssembler, _Assembler2D);

  function TiledAssembler() {
    return _Assembler2D.apply(this, arguments) || this;
  }

  var _proto = TiledAssembler.prototype;

  _proto.initData = function initData(sprite) {
    this.verticesCount = 0;
    this.contentWidth = 0;
    this.contentHeight = 0;
    this.rectWidth = 0;
    this.rectHeight = 0;
    this.hRepeat = 0;
    this.vRepeat = 0;
    this.row = 0;
    this.col = 0;

    this._renderData.createFlexData(0, 4, 6, this.getVfmt());

    this._updateIndices();
  };

  _proto.initLocal = function initLocal() {
    this._local = {
      x: [],
      y: []
    };
  };

  _proto._updateIndices = function _updateIndices() {
    var iData = this._renderData.iDatas[0];

    for (var i = 0, vid = 0, l = iData.length; i < l; i += 6, vid += 4) {
      iData[i] = vid;
      iData[i + 1] = vid + 1;
      iData[i + 2] = vid + 2;
      iData[i + 3] = vid + 1;
      iData[i + 4] = vid + 3;
      iData[i + 5] = vid + 2;
    }
  };

  _proto.updateRenderData = function updateRenderData(sprite) {
    var frame = sprite._spriteFrame;
    this.packToDynamicAtlas(sprite, frame);
    var node = sprite.node;
    var contentWidth = this.contentWidth = Math.abs(node.width);
    var contentHeight = this.contentHeight = Math.abs(node.height);
    var rect = frame._rect;
    var rectWidth = this.rectWidth = rect.width;
    var rectHeight = this.rectHeight = rect.height;
    var hRepeat = this.hRepeat = contentWidth / rectWidth;
    var vRepeat = this.vRepeat = contentHeight / rectHeight;
    var row = this.row = Math.ceil(vRepeat);
    var col = this.col = Math.ceil(hRepeat); // update data property

    var count = row * col;
    this.verticesCount = count * 4;
    this.indicesCount = count * 6;
    var renderData = this._renderData;
    var flexBuffer = renderData._flexBuffer;

    if (flexBuffer.reserve(this.verticesCount, this.indicesCount)) {
      this._updateIndices();

      this.updateColor(sprite);
    }

    flexBuffer.used(this.verticesCount, this.indicesCount);

    if (sprite._vertsDirty) {
      this.updateUVs(sprite);
      this.updateVerts(sprite);
      sprite._vertsDirty = false;
    }
  };

  _proto.updateVerts = function updateVerts(sprite) {
    var node = sprite.node,
        appx = node.anchorX * node.width,
        appy = node.anchorY * node.height;
    var row = this.row,
        col = this.col,
        rectWidth = this.rectWidth,
        rectHeight = this.rectHeight,
        contentWidth = this.contentWidth,
        contentHeight = this.contentHeight;
    var _this$_local = this._local,
        x = _this$_local.x,
        y = _this$_local.y;
    x.length = y.length = 0;

    for (var i = 0; i <= col; ++i) {
      x[i] = Math.min(rectWidth * i, contentWidth) - appx;
    }

    for (var _i = 0; _i <= row; ++_i) {
      y[_i] = Math.min(rectHeight * _i, contentHeight) - appy;
    }

    this.updateWorldVerts(sprite);
  };

  _proto.updateWorldVerts = function updateWorldVerts(sprite) {
    var renderData = this._renderData;
    var local = this._local;
    var localX = local.x,
        localY = local.y;
    var world = renderData.vDatas[0];
    var row = this.row,
        col = this.col;
    var matrix = sprite.node._worldMatrix;
    var matrixm = matrix.m;
    var a = matrixm[0],
        b = matrixm[1],
        c = matrixm[4],
        d = matrixm[5],
        tx = matrixm[12],
        ty = matrixm[13];
    var x, x1, y, y1;
    var floatsPerVert = this.floatsPerVert;
    var vertexOffset = 0;

    for (var yindex = 0, ylength = row; yindex < ylength; ++yindex) {
      y = localY[yindex];
      y1 = localY[yindex + 1];

      for (var xindex = 0, xlength = col; xindex < xlength; ++xindex) {
        x = localX[xindex];
        x1 = localX[xindex + 1]; // lb

        world[vertexOffset] = x * a + y * c + tx;
        world[vertexOffset + 1] = x * b + y * d + ty;
        vertexOffset += floatsPerVert; // rb

        world[vertexOffset] = x1 * a + y * c + tx;
        world[vertexOffset + 1] = x1 * b + y * d + ty;
        vertexOffset += floatsPerVert; // lt

        world[vertexOffset] = x * a + y1 * c + tx;
        world[vertexOffset + 1] = x * b + y1 * d + ty;
        vertexOffset += floatsPerVert; // rt

        world[vertexOffset] = x1 * a + y1 * c + tx;
        world[vertexOffset + 1] = x1 * b + y1 * d + ty;
        vertexOffset += floatsPerVert;
      }
    }
  };

  _proto.updateUVs = function updateUVs(sprite) {
    var verts = this._renderData.vDatas[0];
    if (!verts) return;
    var row = this.row,
        col = this.col,
        hRepeat = this.hRepeat,
        vRepeat = this.vRepeat;
    var uv = sprite.spriteFrame.uv;
    var rotated = sprite.spriteFrame._rotated;
    var floatsPerVert = this.floatsPerVert,
        uvOffset = this.uvOffset;

    for (var yindex = 0, ylength = row; yindex < ylength; ++yindex) {
      var coefv = Math.min(1, vRepeat - yindex);

      for (var xindex = 0, xlength = col; xindex < xlength; ++xindex) {
        var coefu = Math.min(1, hRepeat - xindex); // UV

        if (rotated) {
          // lb
          verts[uvOffset] = uv[0];
          verts[uvOffset + 1] = uv[1];
          uvOffset += floatsPerVert; // rb

          verts[uvOffset] = uv[0];
          verts[uvOffset + 1] = uv[1] + (uv[7] - uv[1]) * coefu;
          uvOffset += floatsPerVert; // lt

          verts[uvOffset] = uv[0] + (uv[6] - uv[0]) * coefv;
          verts[uvOffset + 1] = uv[1];
          uvOffset += floatsPerVert; // rt

          verts[uvOffset] = verts[uvOffset - floatsPerVert];
          verts[uvOffset + 1] = verts[uvOffset + 1 - floatsPerVert * 2];
          uvOffset += floatsPerVert;
        } else {
          // lb
          verts[uvOffset] = uv[0];
          verts[uvOffset + 1] = uv[1];
          uvOffset += floatsPerVert; // rb

          verts[uvOffset] = uv[0] + (uv[6] - uv[0]) * coefu;
          verts[uvOffset + 1] = uv[1];
          uvOffset += floatsPerVert; // lt

          verts[uvOffset] = uv[0];
          verts[uvOffset + 1] = uv[1] + (uv[7] - uv[1]) * coefv;
          uvOffset += floatsPerVert; // rt

          verts[uvOffset] = verts[uvOffset - floatsPerVert * 2];
          verts[uvOffset + 1] = verts[uvOffset + 1 - floatsPerVert];
          uvOffset += floatsPerVert;
        }
      }
    }
  };

  return TiledAssembler;
}(_assembler2d["default"]);

exports["default"] = TiledAssembler;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRpbGVkLmpzIl0sIm5hbWVzIjpbIlRpbGVkQXNzZW1ibGVyIiwiaW5pdERhdGEiLCJzcHJpdGUiLCJ2ZXJ0aWNlc0NvdW50IiwiY29udGVudFdpZHRoIiwiY29udGVudEhlaWdodCIsInJlY3RXaWR0aCIsInJlY3RIZWlnaHQiLCJoUmVwZWF0IiwidlJlcGVhdCIsInJvdyIsImNvbCIsIl9yZW5kZXJEYXRhIiwiY3JlYXRlRmxleERhdGEiLCJnZXRWZm10IiwiX3VwZGF0ZUluZGljZXMiLCJpbml0TG9jYWwiLCJfbG9jYWwiLCJ4IiwieSIsImlEYXRhIiwiaURhdGFzIiwiaSIsInZpZCIsImwiLCJsZW5ndGgiLCJ1cGRhdGVSZW5kZXJEYXRhIiwiZnJhbWUiLCJfc3ByaXRlRnJhbWUiLCJwYWNrVG9EeW5hbWljQXRsYXMiLCJub2RlIiwiTWF0aCIsImFicyIsIndpZHRoIiwiaGVpZ2h0IiwicmVjdCIsIl9yZWN0IiwiY2VpbCIsImNvdW50IiwiaW5kaWNlc0NvdW50IiwicmVuZGVyRGF0YSIsImZsZXhCdWZmZXIiLCJfZmxleEJ1ZmZlciIsInJlc2VydmUiLCJ1cGRhdGVDb2xvciIsInVzZWQiLCJfdmVydHNEaXJ0eSIsInVwZGF0ZVVWcyIsInVwZGF0ZVZlcnRzIiwiYXBweCIsImFuY2hvclgiLCJhcHB5IiwiYW5jaG9yWSIsIm1pbiIsInVwZGF0ZVdvcmxkVmVydHMiLCJsb2NhbCIsImxvY2FsWCIsImxvY2FsWSIsIndvcmxkIiwidkRhdGFzIiwibWF0cml4IiwiX3dvcmxkTWF0cml4IiwibWF0cml4bSIsIm0iLCJhIiwiYiIsImMiLCJkIiwidHgiLCJ0eSIsIngxIiwieTEiLCJmbG9hdHNQZXJWZXJ0IiwidmVydGV4T2Zmc2V0IiwieWluZGV4IiwieWxlbmd0aCIsInhpbmRleCIsInhsZW5ndGgiLCJ2ZXJ0cyIsInV2Iiwic3ByaXRlRnJhbWUiLCJyb3RhdGVkIiwiX3JvdGF0ZWQiLCJ1dk9mZnNldCIsImNvZWZ2IiwiY29lZnUiLCJBc3NlbWJsZXIy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Q0FBTCxHQUFrQkwsS0FBSyxDQUFDSyxRQUFRLEdBQUdYLGFBQWEsR0FBRyxDQUE1QixDQUF2QjtBQUNBTSxVQUFBQSxLQUFLLENBQUNLLFFBQVEsR0FBRyxDQUFaLENBQUwsR0FBc0JMLEtBQUssQ0FBQ0ssUUFBUSxHQUFHLENBQVgsR0FBZVgsYUFBaEIsQ0FBM0I7QUFDQVcsVUFBQUEsUUFBUSxJQUFJWCxhQUFaO0FBQ0g7QUFDSjtBQUNKO0FBQ0o7OztFQWxMdUNjIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cblxuIGh0dHBzOi8vd3d3LmNvY29zLmNvbS9cblxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcbiB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXG4gdG8gdXNlIENvY29zIENyZWF0b3Igc29sZWx5IHRvIGRldmVsb3AgZ2FtZXMgb24geW91ciB0YXJnZXQgcGxhdGZvcm1zLiBZb3Ugc2hhbGxcbiBub3QgdXNlIENvY29zIENyZWF0b3Igc29mdHdhcmUgZm9yIGRldmVsb3Bpbmcgb3RoZXIgc29mdHdhcmUgb3IgdG9vbHMgdGhhdCdzXG4gdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxuIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiBDb2NvcyBDcmVhdG9yLlxuXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cbiBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC4gcmVzZXJ2ZXMgYWxsIHJpZ2h0cyBub3QgZXhwcmVzc2x5IGdyYW50ZWQgdG8geW91LlxuXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbiBUSEUgU09GVFdBUkUuXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuaW1wb3J0IEFzc2VtYmxlcjJEIGZyb20gJy4uLy4uLy4uLy4uL2Fzc2VtYmxlci0yZCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRpbGVkQXNzZW1ibGVyIGV4dGVuZHMgQXNzZW1ibGVyMkQge1xuICAgIGluaXREYXRhIChzcHJpdGUpIHtcbiAgICAgICAgdGhpcy52ZXJ0aWNlc0NvdW50ID0gMDtcbiAgICAgICAgdGhpcy5jb250ZW50V2lkdGggPSAwO1xuICAgICAgICB0aGlzLmNvbnRlbnRIZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLnJlY3RXaWR0aCA9IDA7XG4gICAgICAgIHRoaXMucmVjdEhlaWdodCA9IDA7XG4gICAgICAgIHRoaXMuaFJlcGVhdCA9IDA7XG4gICAgICAgIHRoaXMudlJlcGVhdCA9IDA7XG4gICAgICAgIHRoaXMucm93ID0gMDtcbiAgICAgICAgdGhpcy5jb2wgPSAwO1xuXG4gICAgICAgIHRoaXMuX3JlbmRlckRhdGEuY3JlYXRlRmxleERhdGEoMCwgNCwgNiwgdGhpcy5nZXRWZm10KCkpO1xuICAgICAgICB0aGlzLl91cGRhdGVJbmRpY2VzKCk7XG4gICAgfVxuXG4gICAgaW5pdExvY2FsICgpIHtcbiAgICAgICAgdGhpcy5fbG9jYWwgPSB7IHg6IFtdLCB5OiBbXX07XG4gICAgfVxuXG4gICAgX3VwZGF0ZUluZGljZXMgKCkge1xuICAgICAgICBsZXQgaURhdGEgPSB0aGlzLl9yZW5kZXJEYXRhLmlEYXRhc1swXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIHZpZCA9IDAsIGwgPSBpRGF0YS5sZW5ndGg7IGkgPCBsOyBpICs9IDYsIHZpZCArPSA0KSB7XG4gICAgICAgICAgICBpRGF0YVtpXSA9IHZpZDtcbiAgICAgICAgICAgIGlEYXRhW2kgKyAxXSA9IHZpZCArIDE7XG4gICAgICAgICAgICBpRGF0YVtpICsgMl0gPSB2aWQgKyAyO1xuICAgICAgICAgICAgaURhdGFbaSArIDNdID0gdmlkICsgMTtcbiAgICAgICAgICAgIGlEYXRhW2kgKyA0XSA9IHZpZCArIDM7XG4gICAgICAgICAgICBpRGF0YVtpICsgNV0gPSB2aWQgKyAyO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdXBkYXRlUmVuZGVyRGF0YSAoc3ByaXRlKSB7XG4gICAgICAgIGxldCBmcmFtZSA9IHNwcml0ZS5fc3ByaXRlRnJhbWU7XG4gICAgICAgIHRoaXMucGFja1RvRHluYW1pY0F0bGFzKHNwcml0ZSwgZnJhbWUpO1xuXG4gICAgICAgIGxldCBub2RlID0gc3ByaXRlLm5vZGU7XG5cbiAgICAgICAgbGV0IGNvbnRlbnRXaWR0aCA9IHRoaXMuY29udGVudFdpZHRoID0gTWF0aC5hYnMobm9kZS53aWR0aCk7XG4gICAgICAgIGxldCBjb250ZW50SGVpZ2h0ID0gdGhpcy5jb250ZW50SGVpZ2h0ID0gTWF0aC5hYnMobm9kZS5oZWlnaHQpO1xuICAgICAgICBsZXQgcmVjdCA9IGZyYW1lLl9yZWN0O1xuICAgICAgICBsZXQgcmVjdFdpZHRoID0gdGhpcy5yZWN0V2lkdGggPSByZWN0LndpZHRoO1xuICAgICAgICBsZXQgcmVjdEhlaWdodCA9IHRoaXMucmVjdEhlaWdodCA9IHJlY3QuaGVpZ2h0O1xuICAgICAgICBsZXQgaFJlcGVhdCA9IHRoaXMuaFJlcGVhdCA9IGNvbnRlbnRXaWR0aCAvIHJlY3RXaWR0aDtcbiAgICAgICAgbGV0IHZSZXBlYXQgPSB0aGlzLnZSZXBlYXQgPSBjb250ZW50SGVpZ2h0IC8gcmVjdEhlaWdodDtcbiAgICAgICAgbGV0IHJvdyA9IHRoaXMucm93ID0gTWF0aC5jZWlsKHZSZXBlYXQpO1xuICAgICAgICBsZXQgY29sID0gdGhpcy5jb2wgPSBNYXRoLmNlaWwoaFJlcGVhdCk7XG5cbiAgICAgICAgLy8gdXBkYXRlIGRhdGEgcHJvcGVydHlcbiAgICAgICAgbGV0IGNvdW50ID0gcm93ICogY29sO1xuICAgICAgICB0aGlzLnZlcnRpY2VzQ291bnQgPSBjb3VudCAqIDQ7XG4gICAgICAgIHRoaXMuaW5kaWNlc0NvdW50ID0gY291bnQgKiA2O1xuXG4gICAgICAgIGxldCByZW5kZXJEYXRhID0gdGhpcy5fcmVuZGVyRGF0YTtcbiAgICAgICAgbGV0IGZsZXhCdWZmZXIgPSByZW5kZXJEYXRhLl9mbGV4QnVmZmVyO1xuICAgICAgICBpZiAoZmxleEJ1ZmZlci5yZXNlcnZlKHRoaXMudmVydGljZXNDb3VudCwgdGhpcy5pbmRpY2VzQ291bnQpKSB7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVJbmRpY2VzKCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbG9yKHNwcml0ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZmxleEJ1ZmZlci51c2VkKHRoaXMudmVydGljZXNDb3VudCwgdGhpcy5pbmRpY2VzQ291bnQpO1xuXG4gICAgICAgIGlmIChzcHJpdGUuX3ZlcnRzRGlydHkpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVVZzKHNwcml0ZSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVZlcnRzKHNwcml0ZSk7XG4gICAgICAgICAgICBzcHJpdGUuX3ZlcnRzRGlydHkgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZVZlcnRzIChzcHJpdGUpIHtcbiAgICAgICAgbGV0IG5vZGUgPSBzcHJpdGUubm9kZSxcbiAgICAgICAgICAgIGFwcHggPSBub2RlLmFuY2hvclggKiBub2RlLndpZHRoLCBhcHB5ID0gbm9kZS5hbmNob3JZICogbm9kZS5oZWlnaHQ7XG5cbiAgICAgICAgbGV0IHsgcm93LCBjb2wsIHJlY3RXaWR0aCwgcmVjdEhlaWdodCwgY29udGVudFdpZHRoLCBjb250ZW50SGVpZ2h0IH0gPSB0aGlzO1xuICAgICAgICBsZXQgeyB4LCB5IH0gPSB0aGlzLl9sb2NhbDtcbiAgICAgICAgeC5sZW5ndGggPSB5Lmxlbmd0aCA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGNvbDsgKytpKSB7XG4gICAgICAgICAgICB4W2ldID0gTWF0aC5taW4ocmVjdFdpZHRoICogaSwgY29udGVudFdpZHRoKSAtIGFwcHg7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gcm93OyArK2kpIHtcbiAgICAgICAgICAgIHlbaV0gPSBNYXRoLm1pbihyZWN0SGVpZ2h0ICogaSwgY29udGVudEhlaWdodCkgLSBhcHB5O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy51cGRhdGVXb3JsZFZlcnRzKHNwcml0ZSk7XG4gICAgfVxuICAgIFxuICAgIHVwZGF0ZVdvcmxkVmVydHMgKHNwcml0ZSkge1xuICAgICAgICBsZXQgcmVuZGVyRGF0YSA9IHRoaXMuX3JlbmRlckRhdGE7XG4gICAgICAgIGxldCBsb2NhbCA9IHRoaXMuX2xvY2FsO1xuICAgICAgICBsZXQgbG9jYWxYID0gbG9jYWwueCwgbG9jYWxZID0gbG9jYWwueTtcbiAgICAgICAgbGV0IHdvcmxkID0gcmVuZGVyRGF0YS52RGF0YXNbMF07XG4gICAgICAgIGxldCB7IHJvdywgY29sIH0gPSB0aGlzO1xuICAgICAgICBsZXQgbWF0cml4ID0gc3ByaXRlLm5vZGUuX3dvcmxkTWF0cml4O1xuICAgICAgICBsZXQgbWF0cml4bSA9IG1hdHJpeC5tO1xuICAgICAgICBsZXQgYSA9IG1hdHJpeG1bMF0sIGIgPSBtYXRyaXhtWzFdLCBjID0gbWF0cml4bVs0XSwgZCA9IG1hdHJpeG1bNV0sXG4gICAgICAgICAgICB0eCA9IG1hdHJpeG1bMTJdLCB0eSA9IG1hdHJpeG1bMTNdO1xuXG4gICAgICAgIGxldCB4LCB4MSwgeSwgeTE7XG4gICAgICAgIGxldCBmbG9hdHNQZXJWZXJ0ID0gdGhpcy5mbG9hdHNQZXJWZXJ0O1xuICAgICAgICBsZXQgdmVydGV4T2Zmc2V0ID0gMDtcbiAgICAgICAgZm9yIChsZXQgeWluZGV4ID0gMCwgeWxlbmd0aCA9IHJvdzsgeWluZGV4IDwgeWxlbmd0aDsgKyt5aW5kZXgpIHtcbiAgICAgICAgICAgIHkgPSBsb2NhbFlbeWluZGV4XTtcbiAgICAgICAgICAgIHkxID0gbG9jYWxZW3lpbmRleCArIDFdO1xuICAgICAgICAgICAgZm9yIChsZXQgeGluZGV4ID0gMCwgeGxlbmd0aCA9IGNvbDsgeGluZGV4IDwgeGxlbmd0aDsgKyt4aW5kZXgpIHtcbiAgICAgICAgICAgICAgICB4ID0gbG9jYWxYW3hpbmRleF07XG4gICAgICAgICAgICAgICAgeDEgPSBsb2NhbFhbeGluZGV4ICsgMV07XG5cbiAgICAgICAgICAgICAgICAvLyBsYlxuICAgICAgICAgICAgICAgIHdvcmxkW3ZlcnRleE9mZnNldF0gPSB4ICogYSArIHkgKiBjICsgdHg7XG4gICAgICAgICAgICAgICAgd29ybGRbdmVydGV4T2Zmc2V0ICsgMV0gPSB4ICogYiArIHkgKiBkICsgdHk7XG4gICAgICAgICAgICAgICAgdmVydGV4T2Zmc2V0ICs9IGZsb2F0c1BlclZlcnQ7XG4gICAgICAgICAgICAgICAgLy8gcmJcbiAgICAgICAgICAgICAgICB3b3JsZFt2ZXJ0ZXhPZmZzZXRdID0geDEgKiBhICsgeSAqIGMgKyB0eDtcbiAgICAgICAgICAgICAgICB3b3JsZFt2ZXJ0ZXhPZmZzZXQgKyAxXSA9IHgxICogYiArIHkgKiBkICsgdHk7XG4gICAgICAgICAgICAgICAgdmVydGV4T2Zmc2V0ICs9IGZsb2F0c1BlclZlcnQ7XG4gICAgICAgICAgICAgICAgLy8gbHRcbiAgICAgICAgICAgICAgICB3b3JsZFt2ZXJ0ZXhPZmZzZXRdID0geCAqIGEgKyB5MSAqIGMgKyB0eDtcbiAgICAgICAgICAgICAgICB3b3JsZFt2ZXJ0ZXhPZmZzZXQgKyAxXSA9IHggKiBiICsgeTEgKiBkICsgdHk7XG4gICAgICAgICAgICAgICAgdmVydGV4T2Zmc2V0ICs9IGZsb2F0c1BlclZlcnQ7XG4gICAgICAgICAgICAgICAgLy8gcnRcbiAgICAgICAgICAgICAgICB3b3JsZFt2ZXJ0ZXhPZmZzZXRdID0geDEgKiBhICsgeTEgKiBjICsgdHg7XG4gICAgICAgICAgICAgICAgd29ybGRbdmVydGV4T2Zmc2V0ICsgMV0gPSB4MSAqIGIgKyB5MSAqIGQgKyB0eTtcbiAgICAgICAgICAgICAgICB2ZXJ0ZXhPZmZzZXQgKz0gZmxvYXRzUGVyVmVydDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZVVWcyAoc3ByaXRlKSB7XG4gICAgICAgIGxldCB2ZXJ0cyA9IHRoaXMuX3JlbmRlckRhdGEudkRhdGFzWzBdO1xuICAgICAgICBpZiAoIXZlcnRzKSByZXR1cm47XG5cbiAgICAgICAgbGV0IHsgcm93LCBjb2wsIGhSZXBlYXQsIHZSZXBlYXQgfSA9IHRoaXM7XG4gICAgICAgIGxldCB1diA9IHNwcml0ZS5zcHJpdGVGcmFtZS51djtcbiAgICAgICAgbGV0IHJvdGF0ZWQgPSBzcHJpdGUuc3ByaXRlRnJhbWUuX3JvdGF0ZWQ7XG4gICAgICAgIGxldCBmbG9hdHNQZXJWZXJ0ID0gdGhpcy5mbG9hdHNQZXJWZXJ0LCB1dk9mZnNldCA9IHRoaXMudXZPZmZzZXQ7XG4gICAgICAgIGZvciAobGV0IHlpbmRleCA9IDAsIHlsZW5ndGggPSByb3c7IHlpbmRleCA8IHlsZW5ndGg7ICsreWluZGV4KSB7XG4gICAgICAgICAgICBsZXQgY29lZnYgPSBNYXRoLm1pbigxLCB2UmVwZWF0IC0geWluZGV4KTtcbiAgICAgICAgICAgIGZvciAobGV0IHhpbmRleCA9IDAsIHhsZW5ndGggPSBjb2w7IHhpbmRleCA8IHhsZW5ndGg7ICsreGluZGV4KSB7XG4gICAgICAgICAgICAgICAgbGV0IGNvZWZ1ID0gTWF0aC5taW4oMSwgaFJlcGVhdCAtIHhpbmRleCk7XG5cbiAgICAgICAgICAgICAgICAvLyBVVlxuICAgICAgICAgICAgICAgIGlmIChyb3RhdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGxiXG4gICAgICAgICAgICAgICAgICAgIHZlcnRzW3V2T2Zmc2V0XSA9IHV2WzBdO1xuICAgICAgICAgICAgICAgICAgICB2ZXJ0c1t1dk9mZnNldCArIDFdID0gdXZbMV07XG4gICAgICAgICAgICAgICAgICAgIHV2T2Zmc2V0ICs9IGZsb2F0c1BlclZlcnQ7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJiXG4gICAgICAgICAgICAgICAgICAgIHZlcnRzW3V2T2Zmc2V0XSA9IHV2WzBdO1xuICAgICAgICAgICAgICAgICAgICB2ZXJ0c1t1dk9mZnNldCArIDFdID0gdXZbMV0gKyAodXZbN10gLSB1dlsxXSkgKiBjb2VmdTtcbiAgICAgICAgICAgICAgICAgICAgdXZPZmZzZXQgKz0gZmxvYXRzUGVyVmVydDtcbiAgICAgICAgICAgICAgICAgICAgLy8gbHRcbiAgICAgICAgICAgICAgICAgICAgdmVydHNbdXZPZmZzZXRdID0gdXZbMF0gKyAodXZbNl0gLSB1dlswXSkgKiBjb2VmdjtcbiAgICAgICAgICAgICAgICAgICAgdmVydHNbdXZPZmZzZXQgKyAxXSA9IHV2WzFdO1xuICAgICAgICAgICAgICAgICAgICB1dk9mZnNldCArPSBmbG9hdHNQZXJWZXJ0O1xuICAgICAgICAgICAgICAgICAgICAvLyBydFxuICAgICAgICAgICAgICAgICAgICB2ZXJ0c1t1dk9mZnNldF0gPSB2ZXJ0c1t1dk9mZnNldCAtIGZsb2F0c1BlclZlcnRdO1xuICAgICAgICAgICAgICAgICAgICB2ZXJ0c1t1dk9mZnNldCArIDFdID0gdmVydHNbdXZPZmZzZXQgKyAxIC0gZmxvYXRzUGVyVmVydCAqIDJdO1xuICAgICAgICAgICAgICAgICAgICB1dk9mZnNldCArPSBmbG9hdHNQZXJWZXJ0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbGJcbiAgICAgICAgICAgICAgICAgICAgdmVydHNbdXZPZmZzZXRdID0gdXZbMF07XG4gICAgICAgICAgICAgICAgICAgIHZlcnRzW3V2T2Zmc2V0ICsgMV0gPSB1dlsxXTtcbiAgICAgICAgICAgICAgICAgICAgdXZPZmZzZXQgKz0gZmxvYXRzUGVyVmVydDtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmJcbiAgICAgICAgICAgICAgICAgICAgdmVydHNbdXZPZmZzZXRdID0gdXZbMF0gKyAodXZbNl0gLSB1dlswXSkgKiBjb2VmdTtcbiAgICAgICAgICAgICAgICAgICAgdmVydHNbdXZPZmZzZXQgKyAxXSA9IHV2WzFdO1xuICAgICAgICAgICAgICAgICAgICB1dk9mZnNldCArPSBmbG9hdHNQZXJWZXJ0O1xuICAgICAgICAgICAgICAgICAgICAvLyBsdFxuICAgICAgICAgICAgICAgICAgICB2ZXJ0c1t1dk9mZnNldF0gPSB1dlswXTtcbiAgICAgICAgICAgICAgICAgICAgdmVydHNbdXZPZmZzZXQgKyAxXSA9IHV2WzFdICsgKHV2WzddIC0gdXZbMV0pICogY29lZnY7XG4gICAgICAgICAgICAgICAgICAgIHV2T2Zmc2V0ICs9IGZsb2F0c1BlclZlcnQ7XG4gICAgICAgICAgICAgICAgICAgIC8vIHJ0XG4gICAgICAgICAgICAgICAgICAgIHZlcnRzW3V2T2Zmc2V0XSA9IHZlcnRzW3V2T2Zmc2V0IC0gZmxvYXRzUGVyVmVydCAqIDJdO1xuICAgICAgICAgICAgICAgICAgICB2ZXJ0c1t1dk9mZnNldCArIDFdID0gdmVydHNbdXZPZmZzZXQgKyAxIC0gZmxvYXRzUGVyVmVydF07XG4gICAgICAgICAgICAgICAgICAgIHV2T2Zmc2V0ICs9IGZsb2F0c1BlclZlcnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG4iXX0=